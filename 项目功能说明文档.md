# 小红书AI发布助手项目功能说明文档

## 1. 项目概述

### 1.1 项目名称
小红书AI发布助手 (xhs-ai-publisher)

### 1.2 项目描述
小红书AI发布助手是一个基于Spring Boot开发的自动化工具，用于帮助用户在小红书平台上生成和发布内容。该项目集成了AI内容生成、浏览器自动化、定时任务等功能，旨在提高用户在小红书平台的内容创作和发布效率。

### 1.3 技术栈

| 技术/框架 | 版本 | 用途 |
|---------|------|------|
| Spring Boot | 4.0.0 | 核心框架 |
| Java | 25 | 开发语言 |
| MySQL | 8.0 | 数据库 |
| Playwright | 1.40.0 | 浏览器自动化 |
| Quartz | 2.3.2 | 定时任务 |
| Spring Security | 6.3.0 | 安全框架 |
| Spring Data JPA | 4.0.0 | 数据访问 |
| ModelMapper | 3.2.1 | 对象映射 |
| Lombok | 1.18.36 | 代码简化 |

## 2. 项目架构

### 2.1 架构设计
项目采用分层架构设计，包括：
- **Controller层**：处理HTTP请求，提供RESTful API
- **Service层**：实现业务逻辑
- **Repository层**：数据访问层，与数据库交互
- **Entity层**：数据模型，映射数据库表
- **AI层**：AI内容生成相关功能
- **Browser层**：浏览器自动化相关功能
- **Analysis层**：内容分析相关功能

### 2.2 核心依赖关系
```
Controller -> Service -> Repository
Service -> AI层/ Browser层/ Analysis层
AI层 -> 第三方AI服务
Browser层 -> Playwright
```

## 3. 核心功能模块

### 3.1 AI内容生成模块

#### 3.1.1 功能描述
该模块负责与第三方AI服务集成，使用AI生成小红书内容，包括文案、标题等。

#### 3.1.2 支持的AI模型
- **Kimi**：由月之暗面开发的AI模型
- **Qwen**：由阿里云开发的AI模型

#### 3.1.3 核心接口
- `AIAdapter`：定义了AI适配器的通用接口，包括生成内容、获取模型名称、测试连接等方法
- `AIProviderFactory`：工厂类，用于创建不同类型的AI适配器

#### 3.1.4 主要功能
- 生成小红书文案
- 生成小红书标题
- 测试AI模型连接
- 支持不同AI模型的切换

### 3.2 内容分析模块

#### 3.2.1 功能描述
该模块负责对文本内容进行分析，提取关键词、主题、情感等信息，为AI生成内容提供依据。

#### 3.2.2 核心接口
- `ContentAnalyzer`：定义了内容分析的接口
- `ContentAnalysis`：表示内容分析结果的数据模型

#### 3.2.3 分析维度
- 标题提取
- 主题识别
- 关键词提取
- 情感分析
- 目标受众定位
- 配色方案推荐
- 风格偏好分析

### 3.3 浏览器自动化模块

#### 3.3.1 功能描述
该模块使用Playwright实现浏览器自动化，用于登录小红书和发布笔记。

#### 3.3.2 核心功能
- 初始化Playwright和浏览器实例
- 创建浏览器上下文
- 注入反检测脚本，避免被小红书识别为自动化工具
- 登录小红书
- 发布小红书笔记
- 上传图片

#### 3.3.3 浏览器配置
- 支持设置浏览器指纹（user-agent、viewport、screen size等）
- 支持设置代理
- 支持设置地理位置

### 3.4 发布管理模块

#### 3.4.1 功能描述
该模块负责管理小红书笔记的发布过程，包括发布笔记、记录发布历史等。

#### 3.4.2 核心功能
- 发布小红书笔记
- 记录发布历史
- 查询发布历史
- 查询发布历史详情

#### 3.4.3 发布流程
1. 创建发布历史记录
2. 获取用户信息和默认浏览器环境
3. 创建浏览器上下文
4. 登录小红书
5. 发布笔记
6. 更新发布历史记录状态

### 3.5 定时任务模块

#### 3.5.1 功能描述
该模块使用Quartz实现定时任务，支持用户创建、更新、删除定时任务，用于定时发布小红书笔记。

#### 3.5.2 核心功能
- 创建定时任务
- 更新定时任务
- 删除定时任务
- 查询定时任务
- 任务调度和执行

### 3.6 配置管理模块

#### 3.6.1 功能描述
该模块负责管理系统的各种配置，包括浏览器环境配置、浏览器指纹配置、代理配置等。

#### 3.6.2 配置类型
- **浏览器环境配置**：管理浏览器的运行环境，包括是否使用代理、地理位置等
- **浏览器指纹配置**：管理浏览器指纹信息，包括user-agent、viewport、screen size等
- **代理配置**：管理代理信息，包括代理类型、地址、端口等

### 3.7 用户管理模块

#### 3.7.1 功能描述
该模块负责管理系统用户，包括用户注册、登录、查询等功能。

#### 3.7.2 核心功能
- 用户注册
- 用户登录
- 用户查询
- 用户信息更新

#### 3.7.3 安全机制
- 使用Spring Security进行身份验证和授权
- 支持基于角色的访问控制
- 密码加密存储

## 4. 数据库设计

### 4.1 核心实体

#### 4.1.1 User（用户）
- id：用户ID
- username：用户名
- password：密码
- phone：手机号
- email：邮箱
- created_at：创建时间
- updated_at：更新时间

#### 4.1.2 BrowserEnvironment（浏览器环境）
- id：环境ID
- user_id：用户ID
- name：环境名称
- is_default：是否为默认环境
- geolocation_latitude：地理位置纬度
- geolocation_longitude：地理位置经度
- created_at：创建时间
- updated_at：更新时间

#### 4.1.3 BrowserFingerprint（浏览器指纹）
- id：指纹ID
- user_agent：用户代理
- viewport_width：视口宽度
- viewport_height：视口高度
- screen_width：屏幕宽度
- screen_height：屏幕高度
- locale：语言环境
- timezone：时区
- created_at：创建时间
- updated_at：更新时间

#### 4.1.4 ProxyConfig（代理配置）
- id：代理ID
- proxy_type：代理类型（HTTP、HTTPS、SOCKS5等）
- host：代理地址
- port：代理端口
- username：代理用户名
- password：代理密码
- is_enabled：是否启用
- created_at：创建时间
- updated_at：更新时间

#### 4.1.5 PublishHistory（发布历史）
- id：历史ID
- user_id：用户ID
- title：标题
- content：内容
- status：状态（PENDING、SUCCESS、FAILED）
- published_time：发布时间
- error_message：错误信息
- created_at：创建时间
- updated_at：更新时间

#### 4.1.6 ScheduledTask（定时任务）
- id：任务ID
- user_id：用户ID
- title：标题
- content：内容
- image_paths：图片路径
- cron_expression：Cron表达式
- status：状态（ENABLED、DISABLED）
- created_at：创建时间
- updated_at：更新时间

### 4.2 实体关系
- User 1:N BrowserEnvironment
- User 1:N BrowserFingerprint
- User 1:N ProxyConfig
- User 1:N PublishHistory
- User 1:N ScheduledTask
- BrowserEnvironment 1:1 BrowserFingerprint
- BrowserEnvironment 1:1 ProxyConfig

## 5. API接口设计

### 5.1 控制器列表

| 控制器名称 | 功能描述 | 主要接口 |
|---------|---------|---------|
| AIController | AI服务相关接口 | 生成内容、测试AI连接等 |
| BrowserEnvironmentController | 浏览器环境管理接口 | 创建、更新、删除浏览器环境等 |
| BrowserFingerprintController | 浏览器指纹管理接口 | 创建、更新、删除浏览器指纹等 |
| ContentGenerationController | 内容生成接口 | 分析内容、生成小红书文案等 |
| ProxyConfigController | 代理配置管理接口 | 创建、更新、删除代理配置等 |
| PublishController | 发布管理接口 | 发布笔记、查询发布历史等 |
| ScheduledTaskController | 定时任务管理接口 | 创建、更新、删除定时任务等 |
| UserController | 用户管理接口 | 用户注册、登录、查询等 |

### 5.2 主要API示例

#### 5.2.1 生成小红书文案
```
POST /api/content/generate
请求体：
{
  "providerType": "kimi",
  "apiKey": "your-api-key",
  "prompt": "生成一篇关于春天的小红书文案",
  "params": {
    "temperature": 0.7
  }
}
```

#### 5.2.2 发布小红书笔记
```
POST /api/publish/note
请求体：
{
  "userId": 1,
  "title": "春天的第一杯奶茶",
  "content": "今天喝了春天的第一杯奶茶，味道真不错！",
  "imagePaths": ["/path/to/image1.jpg", "/path/to/image2.jpg"]
}
```

#### 5.2.3 创建定时任务
```
POST /api/scheduled-tasks
请求体：
{
  "userId": 1,
  "title": "定时发布笔记",
  "content": "这是一篇定时发布的笔记",
  "imagePaths": ["/path/to/image.jpg"],
  "cronExpression": "0 0 12 * * ?",
  "status": "ENABLED"
}
```

## 6. 安全设计

### 6.1 认证与授权
- 使用Spring Security进行身份验证和授权
- 支持基于角色的访问控制
- 密码使用BCrypt加密存储

### 6.2 浏览器反检测
- 注入反检测脚本，隐藏自动化特征
- 修改navigator.webdriver属性
- 模拟真实浏览器的plugins、languages等属性
- 添加chrome对象
- 禁用Service Worker

### 6.3 数据安全
- 敏感数据加密存储
- 数据库连接使用加密传输
- 定期备份数据库

## 7. 部署与运行

### 7.1 环境要求
- JDK 25+
- MySQL 8.0+
- Maven 3.6+

### 7.2 配置文件
主要配置文件为`application.properties`，包含以下配置：
- 应用基本配置（端口、名称等）
- 数据库配置（URL、用户名、密码等）
- JPA配置
- 日志配置
- 浏览器自动化配置
- Quartz配置
- 文件上传配置
- 安全配置

### 7.3 运行命令
```
mvn spring-boot:run
```

## 8. 项目特点与优势

### 8.1 多AI模型支持
支持Kimi和Qwen等多种AI模型，用户可以根据需求选择合适的模型，提高内容生成的质量和多样性。

### 8.2 浏览器自动化
使用Playwright实现浏览器自动化，支持登录小红书和发布笔记，减少手动操作，提高发布效率。

### 8.3 反检测机制
实现了浏览器反检测机制，避免被小红书识别为自动化工具，提高发布成功率。

### 8.4 定时发布
支持定时发布功能，用户可以提前规划内容发布时间，提高内容运营效率。

### 8.5 配置灵活
支持浏览器指纹、代理、地理位置等多种配置，用户可以根据需要进行调整，适应不同的发布场景。

### 8.6 易于扩展
采用分层架构和接口设计，便于扩展新的功能和支持新的AI模型。

## 9. 待完善功能

### 9.1 登录功能
目前登录小红书的功能尚未完全实现，需要根据小红书登录页面的实际情况进行调整。

### 9.2 发布笔记功能
目前发布笔记的功能尚未完全实现，需要根据小红书发布页面的实际情况进行调整。

### 9.3 图片上传功能
目前图片上传的功能尚未完全实现，需要根据小红书图片上传的实际情况进行调整。

### 9.4 内容模板功能
计划添加内容模板功能，用户可以创建和使用内容模板，提高内容生成效率。

### 9.5 数据分析功能
计划添加数据分析功能，对发布的笔记进行数据分析，提供发布效果统计和建议。

## 10. 总结

小红书AI发布助手是一个功能全面、设计合理的自动化工具，旨在帮助用户提高在小红书平台的内容创作和发布效率。该项目集成了AI内容生成、浏览器自动化、定时任务等功能，支持多种AI模型和灵活的配置选项。虽然部分功能尚未完全实现，但整体架构设计合理，易于扩展和维护，具有良好的发展前景。